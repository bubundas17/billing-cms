<div class='mx-2 my-3'>

  {{> flash-message }}

  <div class="container-fluid">
    <div class="card card-info">
      <div class="card-info__header">
        <div class='card-info__header-name h-2.5 d-flex align-items-center'>
          <span class='ms-2 card-info__header-name'>
            {{#if edit}}
            Update Product: {{ product.name }}
            {{else}}
            Add New Product
            {{/if}}
          </span>
        </div>
      </div>
      <div class="card-info__content">
        <form name="productForm" {{#if edit}} action='/admin/products/edit/{{product._id}}' {{else}}
          action='/admin/products/new' {{/if}} method='post'>
          <div class='rounded client-details'>
            <div class='mt-2 row row-cols-1 row-cols-xl-2 g-2 m-0'>
              <div class='px-4 py-2'>
                <div class='mb-3 row'>
                  <label for='name'
                    class='custom-base-text custom-base-text-lilac_blue col-auto col-form-label text-nowrap'
                    style='width: 8.5rem;'>
                    Name
                  </label>
                  <div class='col-12 col-md-8'>
                    <input type='text' name="name"
                      class='form-control custom-base-text custom-base-text-lilac_blue {{errorInput errors "name"}}'
                      id='name' style='width: 100%;' value='{{product.name}}' />
                    {{errorMessage errors 'name'}}
                  </div>
                </div>

                <div class='mb-3 row mr-0 pr-0'>
                  <label for='description' name="description"
                    class='col-auto col-form-label text-nowrap custom-base-text custom-base-text-lilac_blue'
                    style='width: 8.5rem;'>
                    Description
                  </label>
                  <div class='col-12 col-md-8'>
                    <textarea rows="10" type='text'
                      class='form-control custom-base-text custom-base-text-lilac_blue m-0 {{errorInput errors "description"}}'
                      name="description" id='description' style='width: 100%;'>{{product.description}}</textarea>
                    {{errorMessage errors 'description'}}
                  </div>
                </div>
              </div>
              <div class="px-4">
                <div class="py-2">
                  <button type="button" id="addNewPrice" class="btn btn-primary">Add new price</button>
                </div>
                <div id="priceInputs"></div>
              </div>
            </div>

            <div class='row row-cols-1 g-2 m-0'>
              <div class='px-4 pb-4 text-center'>
                <button type='submit' class='col-auto btn btn--bright_navy_blue'>
                  {{#if edit}}
                  <i class='fas fa-save'></i>
                  <span class='ms-2'>Update Product</span>
                  {{else}}
                  <i class='fas fa-save'></i>
                  <span class='ms-2'>Save Product</span>
                  {{/if}}
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  let priceInputsCount = 1

  function increasePriceCount() {
    priceInputsCount++;
  }

  function getInputsCount() {
    return priceInputsCount;
  }


  function addNewPriceInput(inputsCount) {
    increasePriceCount()

    return `<div>
                    <div class='mb-3 row'>
                      <label for='price-${inputsCount}' name="price-${inputsCount}"
                        class='col-auto col-form-label text-nowrap custom-base-text custom-base-text-lilac_blue {{errorInput errors "price"}}'
                        style='width: 8.5rem;'>
                        Price ${inputsCount}
                      </label>
                      <div class='col-12 col-md-8'>
                        <input type='text' class='form-control custom-base-text custom-base-text-lilac_blue' id='price-${inputsCount}'
                          name="price-${inputsCount}" style='width: 100%;' value='{{product.price}}' />
                        {{errorMessage errors 'price'}}
                      </div>
                    </div>

                    <div class='mb-3 row'>
                      <label for='label-${inputsCount}' name="label-${inputsCount}"
                        class='col-auto col-form-label text-nowrap custom-base-text custom-base-text-lilac_blue'
                        style='width: 8.5rem;'>
                        Price Label
                      </label>
                      <div class='col-12 col-md-8'>
                        <input type='text'
                          class='form-control custom-base-text custom-base-text-lilac_blue {{errorInput errors "label"}}'
                          id='label-${inputsCount}' name="label-${inputsCount}" style='width: 100%;' value="{{product.label}}" />
                        {{errorMessage errors 'label'}}
                      </div>
                    </div>

                    <div class='mb-3 row'>
                      <label for='duration-${inputsCount}'
                        class='col-auto col-form-label text-nowrap custom-base-text custom-base-text-lilac_blue'
                        style='width: 8.5rem;'>
                        Price Duration
                      </label>
                      <div class='col-12 col-md-8'>
                        <input type='text'
                          class='form-control custom-base-text custom-base-text-lilac_blue {{errorInput errors "duration"}}'
                          name="duration-${inputsCount}" value="{{product.duration}}" id='duration-${inputsCount}' style='width: 100%;' />
                        {{errorMessage errors 'duration'}}
                      </div>
                    </div>
                  </div>`
  }


  const addEditForm = document.querySelector('form[name="productForm"]');

  const addNewPrice = document.getElementById('addNewPrice');
  const priceInputs = document.getElementById('priceInputs');

  priceInputs.innerHTML += addNewPriceInput(getInputsCount());

  addNewPrice.addEventListener('click', function () {
    priceInputs.innerHTML += addNewPriceInput(getInputsCount());
  });

  addEditForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const formData = new FormData(addEditForm);

    const prices = [];
    for (let i = 1; i <= priceInputsCount; i++) {
      console.log(formData.get('price-' + i));
      prices.push = {
        price: formData.get(`price-${i}`),
        label: formData.get(`label-${i}`),
        duration: formData.get(`duration-${i}`)
      }  
    }

    const product = {
      name: formData.get('name'),
      description: formData.get('description'),
      prices
    }

    console.log(product);
  });

</script>